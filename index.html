<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mentex - Estudos Musicais 8 bits</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet" />
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      background: #000;
      color: #0ff;
      font-family: 'Press Start 2P', cursive;
      font-size: 12px;
      line-height: 1.4;
      user-select: none;
    }
    h1, h2 {
      color: #0ff;
      text-shadow: 1px 1px #00aabb;
      margin: 20px;
      text-align: center;
    }
    header {
      background: #002233;
      padding: 10px 0;
      border-bottom: 3px solid #0ff;
      user-select: none;
    }
    .container {
      display: flex;
      height: calc(100vh - 60px);
    }
    aside.sidebar {
      width: 180px;
      background: #001122;
      border-right: 3px solid #0ff;
      padding: 15px;
      display: flex;
      flex-direction: column;
      gap: 15px;
      user-select: none;
    }
    aside.sidebar button {
      background: #003344;
      border: 2px solid #0ff;
      color: #0ff;
      font-size: 9px;
      padding: 10px 5px;
      cursor: pointer;
      text-align: center;
      transition: background 0.3s;
      letter-spacing: 1px;
      border-radius: 4px;
      user-select: none;
    }
    aside.sidebar button.active,
    aside.sidebar button:hover {
      background: #0ff;
      color: #002233;
      font-weight: bold;
    }
    .abas-vertical {
      margin-top: 10px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      user-select: none;
    }
    .abas-vertical button {
      background: #002233;
      border: 1px solid #0ff;
      color: #0ff;
      font-size: 9px;
      padding: 6px 0;
      cursor: pointer;
      border-radius: 3px;
      user-select: none;
    }
    .abas-vertical button.active,
    .abas-vertical button:hover {
      background: #0ff;
      color: #002233;
      font-weight: bold;
    }
    main.content {
      flex: 1;
      padding: 20px;
      background: #000;
      overflow-y: auto;
      user-select: text;
    }
    form#post-form {
      margin-bottom: 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      user-select: none;
    }
    form textarea {
      resize: vertical;
      min-height: 80px;
      font-family: 'Press Start 2P', cursive;
      font-size: 10px;
      background: #001122;
      color: #0ff;
      border: 2px solid #0ff;
      padding: 10px;
      border-radius: 5px;
      outline: none;
    }
    form select, form input[type="file"] {
      font-family: 'Press Start 2P', cursive;
      font-size: 10px;
      padding: 5px;
      border: 2px solid #0ff;
      border-radius: 5px;
      background: #001122;
      color: #0ff;
      cursor: pointer;
    }
    form button {
      width: 140px;
      padding: 10px;
      font-family: 'Press Start 2P', cursive;
      font-size: 10px;
      background: #0ff;
      border: none;
      color: #002233;
      cursor: pointer;
      border-radius: 5px;
      transition: background 0.3s;
      align-self: flex-start;
      user-select: none;
    }
    form button:hover {
      background: #00aabb;
    }
    ul#posts-list {
      list-style: none;
      padding: 0;
      margin: 0;
      user-select: text;
    }
    ul#posts-list li {
      background: #001122;
      margin-bottom: 10px;
      padding: 10px;
      border: 2px solid #0ff;
      border-radius: 5px;
      position: relative;
      font-size: 10px;
      white-space: pre-wrap;
      user-select: text;
    }
    ul#posts-list li button.excluir-btn {
      position: absolute;
      top: 5px;
      right: 5px;
      background: #ff0055;
      border: none;
      color: #fff;
      font-family: 'Press Start 2P', cursive;
      font-size: 8px;
      padding: 3px 6px;
      cursor: pointer;
      border-radius: 3px;
      user-select: none;
      transition: background 0.3s;
    }
    ul#posts-list li button.excluir-btn:hover {
      background: #cc0044;
    }
    .audio-player {
      margin-top: 5px;
      width: 100%;
      outline: none;
      border-radius: 5px;
      background: #002233;
    }
    label[for="tipo-post"] {
      font-size: 10px;
      user-select: none;
      margin-bottom: 5px;
    }
  </style>
</head>
<body>
  <header>
    <h1>Mentex - Estudos Musicais 8 bits</h1>
  </header>
  <div class="container">
    <aside class="sidebar">
      <button data-categoria="Todos" class="active">Todos</button>

      <button data-categoria="Melodias">Melodias</button>
      <div class="abas-vertical" id="abas-melodias" style="display:none;">
        <button data-cat="Melodias" data-numero="1">1</button>
        <button data-cat="Melodias" data-numero="2">2</button>
        <button data-cat="Melodias" data-numero="3">3</button>
        <button data-cat="Melodias" data-numero="4">4</button>
        <button data-cat="Melodias" data-numero="5">5</button>
      </div>

      <button data-categoria="Ideias">Ideias</button>
      <div class="abas-vertical" id="abas-ideias" style="display:none;">
        <button data-cat="Ideias" data-numero="1">1</button>
        <button data-cat="Ideias" data-numero="2">2</button>
        <button data-cat="Ideias" data-numero="3">3</button>
        <button data-cat="Ideias" data-numero="4">4</button>
        <button data-cat="Ideias" data-numero="5">5</button>
      </div>

      <button data-categoria="Composições">Composições</button>
      <div class="abas-vertical" id="abas-composicoes" style="display:none;">
        <button data-cat="Composições" data-numero="1">1</button>
        <button data-cat="Composições" data-numero="2">2</button>
        <button data-cat="Composições" data-numero="3">3</button>
        <button data-cat="Composições" data-numero="4">4</button>
        <button data-cat="Composições" data-numero="5">5</button>
      </div>
    </aside>
    <main class="content">
      <form id="post-form">
        <label for="tipo-post">Tipo de Post:</label>
        <select id="tipo-post" name="tipo-post">
          <option value="texto" selected>Texto</option>
          <option value="audio">Áudio (até 2 min)</option>
        </select>

        <textarea id="post-text" placeholder="Escreva seu post aqui..."></textarea>
        <input type="file" id="post-audio" accept="audio/*" style="display:none;" />

        <select id="categoria-select">
          <option value="Todos">Todos</option>
          <option value="Melodias">Melodias</option>
          <option value="Ideias">Ideias</option>
          <option value="Composições">Composições</option>
        </select>
        <button type="submit">Postar</button>
      </form>
      <ul id="posts-list"></ul>
    </main>
  </div>

<script>
  const posts = {
    Todos: { 1: [] },
    Melodias: { 1: [], 2: [], 3: [], 4: [], 5: [] },
    Ideias: { 1: [], 2: [], 3: [], 4: [], 5: [] },
    Composições: { 1: [], 2: [], 3: [], 4: [], 5: [] },
  };

  let filtroCategoriaAtual = 'Todos';
  const filtroAbaAtual = {
    Todos: 1,
    Melodias: 1,
    Ideias: 1,
    Composições: 1
  };

  const sidebarButtons = document.querySelectorAll('aside.sidebar > button');
  const abasButtons = document.querySelectorAll('.abas-vertical button');
  const postsList = document.getElementById('posts-list');
  const form = document.getElementById('post-form');
  const textarea = document.getElementById('post-text');
  const categoriaSelect = document.getElementById('categoria-select');
  const tipoPostSelect = document.getElementById('tipo-post');
  const audioInput = document.getElementById('post-audio');

  // Mostrar ou esconder textarea e audio input conforme tipo escolhido
  tipoPostSelect.addEventListener('change', () => {
    if(tipoPostSelect.value === 'audio') {
      textarea.style.display = 'none';
      audioInput.style.display = 'block';
    } else {
      textarea.style.display = 'block';
      audioInput.style.display = 'none';
      audioInput.value = '';
    }
  });

  function renderPosts() {
    postsList.innerHTML = '';
    let listaPosts = [];

    if(filtroCategoriaAtual === 'Todos') {
      listaPosts = posts.Todos[1];
    } else {
      listaPosts = posts[filtroCategoriaAtual][filtroAbaAtual[filtroCategoriaAtual]];
    }

    if (listaPosts.length === 0) {
      const vazioLi = document.createElement('li');
      vazioLi.textContent = 'Nenhum post nesta aba.';
      vazioLi.style.fontStyle = 'italic';
      vazioLi.style.color = '#004444';
      postsList.appendChild(vazioLi);
      return;
    }

    listaPosts.forEach((post, index) => {
      const li = document.createElement('li');

      if(post.tipo === 'texto') {
        li.textContent = post.texto;
      } else if(post.tipo === 'audio') {
        li.textContent = post.texto || '';
        const audioElem = document.createElement('audio');
        audioElem.controls = true;
        audioElem.className = 'audio-player';

        // Criar URL temporária para o áudio base64
        audioElem.src = post.audioURL;

        li.appendChild(audioElem);
      }

      const btnExcluir = document.createElement('button');
      btnExcluir.textContent = 'X';
      btnExcluir.className = 'excluir-btn';
      btnExcluir.onclick = () => {
        listaPosts.splice(index, 1);
        renderPosts();
      };

      li.appendChild(btnExcluir);
      postsList.appendChild(li);
    });
  }

  function toggleAbas(categoria) {
    const abas = document.getElementById(`abas-${categoria.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '')}`);
    if (!abas) return false;

    if (abas.style.display === 'flex') {
      abas.style.display = 'none';
      return false;
    } else {
      abas.style.display = 'flex';
      return true;
    }
  }

  function ativarCategoria(categoria) {
    if (filtroCategoriaAtual === categoria) {
      const aberto = toggleAbas(categoria);
      document.querySelector(`aside.sidebar > button[data-categoria="${categoria}"]`).classList.toggle('active', aberto);
      return;
    }

    sidebarButtons.forEach(btn => btn.classList.remove('active'));
    document.querySelector(`aside.sidebar > button[data-categoria="${categoria}"]`).classList.add('active');

    ['melodias', 'ideias', 'composicoes'].forEach(cat => {
      const div = document.getElementById(`abas-${cat}`);
      if(div) div.style.display = 'none';
    });

    if(categoria !== 'Todos') {
      const div = document.getElementById(`abas-${categoria.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '')}`);
      if(div) div.style.display = 'flex';
    }

    filtroCategoriaAtual = categoria;

    renderPosts();
  }

  function ativarAba(categoria, numero) {
    if(filtroAbaAtual[categoria] === numero) return;

    filtroAbaAtual[categoria] = numero;

    const abasCategoria = document.querySelectorAll(`#abas-${categoria.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '')} button`);
    abasCategoria.forEach(btn => {
      btn.classList.toggle('active', btn.dataset.numero === numero.toString());
    });

    renderPosts();
  }

  sidebarButtons.forEach(btn => {
    btn.addEventListener('click', () => ativarCategoria(btn.dataset.categoria));
  });

  abasButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      const categoria = btn.dataset.cat;
      const num = btn.dataset.numero;
      ativarAba(categoria, num);
    });
  });

  // Limite máximo em segundos (2 minutos = 120s)
  const MAX_AUDIO_DURATION = 120;

  form.addEventListener('submit', e => {
    e.preventDefault();

    const tipoPost = tipoPostSelect.value;
    const categoria = categoriaSelect.value;

    if(tipoPost === 'texto') {
      const texto = textarea.value.trim();
      if(!texto) {
        alert('Escreva algo para postar.');
        return;
      }
      posts[categoria][1].unshift({ tipo: 'texto', texto, categoria });
      textarea.value = '';
      categoriaSelect.value = 'Todos';
      ativarCategoria(categoria);
      ativarAba(categoria, 1);
    } else if(tipoPost === 'audio') {
      const arquivo = audioInput.files[0];
      if(!arquivo) {
        alert('Escolha um arquivo de áudio.');
        return;
      }
      if(!arquivo.type.startsWith('audio/')) {
        alert('Por favor, envie um arquivo de áudio válido.');
        return;
      }

      // Verificar duração do áudio
      const audioElem = new Audio();
      const fileURL = URL.createObjectURL(arquivo);

      audioElem.src = fileURL;
      audioElem.load();

      audioElem.onloadedmetadata = () => {
        if(audioElem.duration > MAX_AUDIO_DURATION) {
          alert('Áudio muito longo! Máximo permitido: 2 minutos.');
          URL.revokeObjectURL(fileURL);
          return;
        }

        // Ler arquivo como base64 para armazenar no post
        const reader = new FileReader();
        reader.onload = function(event) {
          const base64Audio = event.target.result;
          posts[categoria][1].unshift({ tipo: 'audio', audioURL: base64Audio, texto: '', categoria });
          URL.revokeObjectURL(fileURL);

          audioInput.value = '';
          categoriaSelect.value = 'Todos';
          tipoPostSelect.value = 'texto';
          textarea.style.display = 'block';
          audioInput.style.display = 'none';

          ativarCategoria(categoria);
          ativarAba(categoria, 1);
        };
        reader.readAsDataURL(arquivo);
      };

      audioElem.onerror = () => {
        alert('Erro ao carregar o áudio. Tente outro arquivo.');
        URL.revokeObjectURL(fileURL);
      };
    }
  });

  // Inicialização
  ativarCategoria('Todos');
  ativarAba('Todos', 1);
  ativarAba('Melodias', 1);
  ativarAba('Ideias', 1);
  ativarAba('Composições', 1);
</script>
</body>
</html>
